# 컨트롤러 리소스 - Index 페이지 생성 규칙

## 개요
@jiny/admin 패키지의 컨트롤러에서 index 페이지는 리스트 페이지를 생성하는 핵심 기능입니다. 컨트롤러는 JSON 설정 파일을 기반으로 뷰를 렌더링하고, Livewire 컴포넌트들과 이벤트 기반으로 동작합니다.

## 1. 뷰 템플릿 전달 구조

### 1.1 기본 흐름
```
Controller → JSON['template']['index'] → View
```

- 컨트롤러는 `AdminUsers.json` 파일의 `template.index` 설정값으로 뷰를 전달합니다
- 기본값: `jiny-admin::template.index`

### 1.2 컨트롤러 구현 예시
```php
public function __invoke(Request $request)
{
    // JSON 설정에서 뷰 경로 확인
    if (!isset($this->jsonData['template']['index'])) {
        return response('Error: template.index 설정이 필요합니다.', 500);
    }
    
    // 뷰 렌더링
    return view($this->jsonData['template']['index'], [
        'jsonData' => $this->jsonData,
        'jsonPath' => $jsonPath,
        'settingsPath' => $settingsPath,
        'controllerClass' => static::class,
    ]);
}
```

## 2. Index 페이지 컴포넌트 구조

Index 페이지는 여러 개의 Livewire 컴포넌트를 포함하며, 각 컴포넌트는 이벤트로 상호 연결됩니다.

### 2.1 주요 컴포넌트

#### Search 컴포넌트
- **레이아웃**: `jiny-admin::template.livewire.admin-search`
- **Include 파일**: `search.blade.php`
- **역할**: 검색 UI 제공
- **특징**: 
  - 검색 필드 요소만 디자인
  - Input 크기와 폰트 크기 일관성 유지
  - Debounce 적용 (기본 300ms)

#### Table 컴포넌트
- **레이아웃**: `jiny-admin::template.livewire.admin-table`
- **Include 파일**: `table.blade.php`
- **역할**: 데이터 테이블 표시
- **특징**:
  - Action 버튼 포함 (View, Edit, Delete)
  - 개별 삭제: Admin-Delete 컴포넌트와 이벤트 연결
  - 선택 삭제: 여러 항목을 레이어 팝업으로 삭제

## 3. 컴포넌트 간 이벤트 연동

### 3.1 이벤트 흐름
```
Search Component
    ↓ (검색 이벤트)
Table Component
    ↓ (삭제 이벤트)
Admin-Delete Component
```

### 3.2 주요 이벤트
- `search-updated`: 검색어 변경 시 테이블 업데이트
- `delete-item`: 개별 항목 삭제
- `bulk-delete`: 선택 항목 일괄 삭제
- `refresh-table`: 테이블 새로고침

## 4. Hook 시스템

특수한 동작이 필요한 경우 Hook 이벤트를 통해 로직을 분리합니다.

### 4.1 Hook 호출 체인
```
Livewire Component → Hook Event → Controller Method
```

### 4.2 주요 Hook 메소드
```php
// 데이터 조회 전
public function hookIndexing($wire) { }

// 데이터 조회 후 (데이터 가공)
public function hookIndexed($wire, $rows) { }

// 테이블 헤더 커스터마이징
public function hookTableHeader($wire) { }

// 페이지네이션 설정
public function hookPagination($wire) { }

// 정렬 설정
public function hookSorting($wire) { }

// 검색 설정
public function hookSearch($wire) { }

// 필터 설정
public function hookFilters($wire) { }

// 커스텀 액션 (특수 동작)
public function hookCustom($wire, $action, $data) { }
```

## 5. JSON 설정 구조

### 5.1 Index 관련 설정
```json
{
    "template": {
        "index": "jiny-admin::template.index"
    },
    "index": {
        "tableLayoutPath": "jiny-admin::template.livewire.admin-table",
        "tablePath": "jiny-admin::admin.admin_users.table",
        "searchLayoutPath": "jiny-admin::template.livewire.admin-search",
        "searchFormPath": "jiny-admin::admin.admin_users.search",
        "features": {
            "enableCreate": true,
            "enableDelete": true,
            "enableEdit": true,
            "enableSearch": true,
            "enableBulkActions": true
        },
        "pagination": {
            "perPage": 20,
            "options": [10, 25, 50, 100]
        },
        "sorting": {
            "default": "created_at",
            "direction": "desc"
        },
        "search": {
            "placeholder": "Search...",
            "debounce": 300
        },
        "table": {
            "columns": {
                "checkbox": { "visible": true, "width": "50px" },
                "id": { "label": "ID", "sortable": true },
                "actions": { "label": "Actions", "width": "150px" }
            }
        }
    }
}
```

## 6. 파일 생성 방지 규칙

이미 완성된 샘플 코드를 참고하여 오동작으로 인한 불필요한 파일 생성을 방지합니다.

### 6.1 파일 명명 규칙
- 컨트롤러: `Admin{Feature}.php`
- JSON 설정: `Admin{Feature}.json`
- 뷰 파일: `{feature}/table.blade.php`, `{feature}/search.blade.php`

### 6.2 필수 검증 사항
1. JSON 설정 파일 존재 여부 확인
2. template.index 설정 확인
3. 뷰 파일 경로 유효성 검증
4. Livewire 컴포넌트 등록 확인

## 7. UI 일관성 가이드

### 7.1 Search 컴포넌트
- Input 크기: 표준 크기 유지 (h-10, text-sm)
- 폰트 크기: 일관된 크기 적용
- 패딩: px-3 py-2 표준 적용
- 보더: border-gray-300 일관성 유지

### 7.2 Table 컴포넌트
- 행 높이: 표준 높이 유지
- 액션 버튼: 일관된 크기와 스타일
- 체크박스: 표준 크기 적용
- 반응형: 모바일 대응 필수

## 8. 성능 최적화

### 8.1 데이터 로딩
- 페이지네이션 적용 (기본 20개)
- Lazy Loading 활용
- 검색 Debounce 적용

### 8.2 이벤트 최적화
- 불필요한 이벤트 발생 최소화
- 배치 작업 시 단일 이벤트로 처리
- 컴포넌트 간 직접 통신 활용

## 9. 보안 고려사항

### 9.1 권한 검증
- 컨트롤러 레벨 권한 체크
- Hook 메소드 내 추가 검증
- CSRF 토큰 검증

### 9.2 데이터 검증
- Input 데이터 sanitization
- SQL Injection 방지
- XSS 방지 처리

---

# 컨트롤러 리소스 - Show 상세보기 페이지 생성 규칙

## 개요
@jiny/admin 패키지의 Show 컨트롤러는 개별 데이터의 상세 정보를 표시하는 페이지를 생성합니다. 일관된 UX를 유지하기 위해 표준 템플릿과 컴포넌트 구조를 따릅니다.

## 1. 뷰 템플릿 전달 구조

### 1.1 기본 흐름
```
Controller → JSON['template']['show'] → View
```

- Admin**Show 컨트롤러는 `AdminUsers.json` 파일의 `template.show` 설정값으로 뷰를 전달합니다
- 기본값: `jiny-admin::template.show` (특별한 경우를 제외하고 수정하지 않음)

### 1.2 컨트롤러 구현 예시
```php
public function __invoke(Request $request, $id)
{
    // 데이터 조회
    $item = DB::table($tableName)->where('id', $id)->first();
    
    // hookShowing 적용 (표시 전 데이터 가공)
    if (method_exists($this, 'hookShowing')) {
        $data = $this->hookShowing(null, $data);
    }
    
    // JSON 설정에서 뷰 경로 확인
    if (!isset($this->jsonData['template']['show'])) {
        return response('Error: template.show 설정이 필요합니다.', 500);
    }
    
    // 뷰 렌더링
    return view($this->jsonData['template']['show'], [
        'controllerClass' => static::class,
        'jsonData' => $this->jsonData,
        'jsonPath' => $jsonPath,
        'data' => $data,
        'id' => $id,
        'title' => $title,
        'subtitle' => '상세 정보'
    ]);
}
```

## 2. Show 페이지 컴포넌트 구조

### 2.1 AdminShow 컴포넌트
- **템플릿 레이아웃**: `jiny-admin::template.show` (일관된 UX 유지)
- **컴포넌트 레이아웃**: `jiny-admin::template.livewire.admin-show`
- **Include 파일**: `show.blade.php` (순수한 내용만 분리)
- **역할**: 상세 정보 표시 및 관리 작업

### 2.2 구조적 특징
```
template.show (전체 레이아웃)
    └── admin-show 컴포넌트
        └── jiny-admin::template.livewire.admin-show (컴포넌트 레이아웃)
            └── show.blade.php (순수 콘텐츠 include)
```

## 3. Hook 시스템 - 특별한 기능 구현

특별한 기능이 필요한 경우 HookCustom 이벤트를 통해 로직을 분리합니다.

### 3.1 Hook 호출 체인
```
Livewire Component → HookCustom Event → Controller Method
```

### 3.2 주요 Hook 메소드

#### 기본 Hook 메소드
```php
// 표시 전 데이터 가공
public function hookShowing($wire, $data) {
    // 날짜 형식 변환
    // Boolean 값 라벨 변환
    return $data;
}

// 표시 후 처리
public function hookShowed($wire, $data) {
    return $data;
}
```

#### 커스텀 Hook 메소드 예시
```php
// 비밀번호 변경 강제
public function hookCustomPasswordResetForce($wire, $params) { }

// 비밀번호 강제 해제
public function hookCustomPasswordResetCancel($wire, $params) { }

// 만료 기간 연장
public function hookCustomPasswordExpiryExtend($wire, $params) { }

// 이메일 인증 관리
public function hookCustomEmailVerify($wire, $params) { }
public function hookCustomEmailUnverify($wire, $params) { }

// 계정 활성화/비활성화
public function hookCustomAccountActivate($wire, $params) { }
public function hookCustomAccountDeactivate($wire, $params) { }

// 비밀번호/계정 초기화
public function hookCustomPasswordReset($wire, $params) { }
```

## 4. JSON 설정 구조

### 4.1 Show 관련 설정
```json
{
    "template": {
        "show": "jiny-admin::template.show"
    },
    "show": {
        "heading": {
            "title": "User Details",
            "description": "View user information"
        },
        "showLayoutPath": "jiny-admin::template.livewire.admin-show",
        "showPath": "jiny-admin::admin.admin_users.show",
        "enableEdit": true,
        "enableDelete": true,
        "enableCreate": true,
        "enableListButton": true,
        "enableSettingsDrawer": true,
        "display": {
            "datetimeFormat": "Y-m-d H:i:s",
            "booleanLabels": {
                "true": "Yes",
                "false": "No"
            }
        }
    }
}
```

## 5. 데이터 처리 및 표시

### 5.1 데이터 가공 (hookShowing)
```php
public function hookShowing($wire, $data)
{
    // 날짜 형식 지정
    $dateFormat = $this->jsonData['show']['display']['datetimeFormat'] ?? 'Y-m-d H:i:s';
    
    if (isset($data['created_at'])) {
        $data['created_at_formatted'] = date($dateFormat, strtotime($data['created_at']));
    }
    
    // Boolean 라벨 처리
    $booleanLabels = $this->jsonData['show']['display']['booleanLabels'] ?? [
        'true' => 'Enabled',
        'false' => 'Disabled'
    ];
    
    if (isset($data['enable'])) {
        $data['enable_label'] = $data['enable'] ? $booleanLabels['true'] : $booleanLabels['false'];
    }
    
    return $data;
}
```

## 6. 특별한 기능 구현 패턴

### 6.1 커스텀 액션 처리
```php
public function hookCustom{ActionName}($wire, $params)
{
    $id = $params['id'] ?? null;
    
    try {
        // 1. 데이터 검증
        $item = DB::table('table_name')->where('id', $id)->first();
        
        // 2. 비즈니스 로직 실행
        DB::table('table_name')->where('id', $id)->update([...]);
        
        // 3. 로그 기록
        DB::table('admin_logs')->insert([...]);
        
        // 4. 성공 메시지
        session()->flash('success', '작업이 완료되었습니다.');
        
        // 5. 컴포넌트 새로고침
        if ($wire) {
            $wire->refreshData();
        }
    } catch (\Exception $e) {
        session()->flash('error', '오류: ' . $e->getMessage());
    }
}
```

## 7. 로깅 및 감사

### 7.1 활동 로그 기록
모든 관리 작업은 감사 추적을 위해 로그를 기록합니다:
- `admin_user_logs`: 일반 활동 로그
- `admin_user_passwords`: 비밀번호 관련 이력
- `admin_user_password_logs`: 비밀번호 작업 로그

### 7.2 로그 정보
```php
DB::table('admin_user_logs')->insert([
    'user_id' => $userId,
    'action' => 'action_name',
    'description' => '작업 설명',
    'details' => json_encode([
        'admin_id' => auth()->id(),
        'admin_email' => auth()->user()->email
    ]),
    'ip_address' => request()->ip(),
    'user_agent' => request()->userAgent(),
    'logged_at' => now()
]);
```

## 8. UI 일관성 가이드

### 8.1 레이아웃 원칙
- 템플릿 수정 최소화: `jiny-admin::template.show` 유지
- 컴포넌트 레이아웃 유지: `jiny-admin::template.livewire.admin-show`
- 콘텐츠만 분리: `show.blade.php`에 순수 내용만 작성

### 8.2 버튼 및 액션
- 편집 버튼: enableEdit 설정에 따라 표시
- 삭제 버튼: enableDelete 설정에 따라 표시
- 목록 버튼: enableListButton 설정에 따라 표시
- 설정 Drawer: enableSettingsDrawer 설정에 따라 표시

## 9. 파일 생성 규칙

### 9.1 파일 명명 규칙
- 컨트롤러: `Admin{Feature}Show.php`
- 뷰 파일: `{feature}/show.blade.php`
- JSON 설정: 메인 `Admin{Feature}.json` 파일 공유

### 9.2 필수 검증 사항
1. JSON 설정의 `template.show` 확인
2. `show` 섹션 설정 검증
3. 데이터 조회 및 존재 여부 확인
4. Hook 메소드 구현 확인

## 10. 보안 고려사항

### 10.1 권한 검증
- ID 파라미터 유효성 검증
- 사용자 권한 확인
- 데이터 접근 권한 체크

### 10.2 데이터 보호
- 민감한 정보 마스킹
- XSS 방지를 위한 이스케이핑
- SQL Injection 방지

---

# 컨트롤러 리소스 - Create 생성 페이지 생성 규칙

## 개요
@jiny/admin 패키지의 Create 컨트롤러는 새로운 데이터를 생성하는 폼 페이지를 제공합니다. 일관된 UX를 유지하기 위해 표준 템플릿과 컴포넌트 구조를 따릅니다.

## 1. 뷰 템플릿 전달 구조

### 1.1 기본 흐름
```
Controller → JSON['template']['create'] → View
```

- Admin**Create 컨트롤러는 `AdminUsers.json` 파일의 `template.create` 설정값으로 뷰를 전달합니다
- 기본값: `jiny-admin::template.create` (특별한 경우를 제외하고 수정하지 않음)

### 1.2 컨트롤러 구현 예시
```php
public function __invoke(Request $request)
{
    // JSON 설정에서 뷰 경로 확인
    if (!isset($this->jsonData['template']['create'])) {
        return response('Error: template.create 설정이 필요합니다.', 500);
    }
    
    // 기본값 설정
    $form = [];
    
    // 뷰 렌더링
    return view($this->jsonData['template']['create'], [
        'jsonData' => $this->jsonData,
        'jsonPath' => $jsonPath,
        'settingsPath' => $settingsPath,
        'form' => $form
    ]);
}
```

## 2. Create 페이지 컴포넌트 구조

### 2.1 AdminCreate 컴포넌트
- **템플릿 레이아웃**: `jiny-admin::template.create` (일관된 UX 유지)
- **컴포넌트 레이아웃**: `jiny-admin::template.livewire.admin-create`
- **Include 파일**: `create.blade.php` (순수한 폼 내용만 분리)
- **역할**: 새 데이터 생성 폼 제공 및 처리

### 2.2 구조적 특징
```
template.create (전체 레이아웃)
    └── admin-create 컴포넌트
        └── jiny-admin::template.livewire.admin-create (컴포넌트 레이아웃)
            └── create.blade.php (순수 폼 콘텐츠 include)
```

## 3. Hook 시스템 - 데이터 처리

### 3.1 Hook 호출 체인
```
Livewire Component → Hook Event → Controller Method → Validation → Store
```

### 3.2 주요 Hook 메소드

#### 기본 Hook 메소드
```php
// 생성 폼 초기화
public function hookCreating($wire, $value) {
    // 기본값 설정
    // 관련 데이터 조회 (예: 사용자 타입 목록)
    return $form;
}

// 데이터 저장 전 처리
public function hookStoring($wire, $form) {
    // 데이터 검증
    // 패스워드 해싱
    // 타임스탬프 추가
    return $form; // 성공시 배열
    return "에러 메시지"; // 실패시 문자열
}

// 데이터 저장 후 처리
public function hookStored($wire, $form) {
    // 관련 데이터 업데이트 (예: 카운트 증가)
    return $form;
}
```

#### 실시간 필드 검증 Hook
```php
// 이메일 필드 실시간 검증
public function hookFormEmail($wire, $value, $fieldName = 'email') {
    // 형식 검증
    // 중복 체크
    $wire->addError('form.email', '에러 메시지');
}

// 패스워드 필드 실시간 검증
public function hookFormPassword($wire, $value, $fieldName = 'password') {
    // PasswordValidator 사용
    // 복잡도 검증
    $wire->addError('form.password', '에러 메시지');
}

// 패스워드 확인 필드 검증
public function hookFormPasswordConfirmation($wire, $value, $fieldName) {
    // 일치 여부 체크
    $wire->addError('form.password_confirmation', '에러 메시지');
}
```

## 4. JSON 설정 구조

### 4.1 Create 관련 설정
```json
{
    "template": {
        "create": "jiny-admin::template.create"
    },
    "create": {
        "heading": {
            "title": "Create New User",
            "description": "Add a new user to the system"
        },
        "createLayoutPath": "jiny-admin::template.livewire.admin-create",
        "formPath": "jiny-admin::admin.admin_users.create",
        "formLayout": "vertical",
        "buttonText": "새 사용자 추가",
        "enableContinueCreate": true,
        "enableListButton": true,
        "enableSettingsDrawer": true,
        "defaults": {
            "isAdmin": false,
            "utype": null
        }
    },
    "store": {
        "enableTransaction": true,
        "defaults": {
            "isAdmin": false
        },
        "messages": {
            "success": "User created successfully.",
            "error": "Error creating user.",
            "continueSuccess": "User created. You can continue adding more."
        },
        "validation": {
            "rules": {
                "name": "required|string|max:255",
                "email": "required|email|unique:users,email",
                "password": "required|string|min:8|confirmed"
            }
        }
    }
}
```

## 5. 데이터 처리 패턴

### 5.1 hookStoring 처리 흐름
```php
public function hookStoring($wire, $form)
{
    // 1. 데이터 검증
    if ($form['password'] !== $form['password_confirmation']) {
        return "패스워드가 일치하지 않습니다."; // 에러시 문자열 반환
    }
    
    // 2. 패스워드 검증 및 해싱
    $passwordValidator = new PasswordValidator;
    if (!$passwordValidator->validate($form['password'], $userData)) {
        return "패스워드 검증 실패: " . implode(' ', $errors);
    }
    $form['password'] = Hash::make($form['password']);
    
    // 3. 불필요한 필드 제거
    unset($form['password_confirmation']);
    unset($form['_token']);
    
    // 4. 타임스탬프 추가
    $form['created_at'] = now();
    $form['updated_at'] = now();
    
    // 5. 성공시 배열 반환
    return $form;
}
```

### 5.2 반환값 규칙
- **성공**: 처리된 form 배열 반환
- **실패**: 에러 메시지 문자열 반환

## 6. 실시간 검증

### 6.1 필드별 실시간 검증
각 필드는 blur 이벤트 또는 실시간 입력시 검증됩니다:
- **이메일**: 형식 검증, 중복 체크
- **패스워드**: 복잡도 검증, 정책 준수
- **패스워드 확인**: 일치 여부

### 6.2 에러 처리
```php
// 에러 추가
$wire->addError('form.fieldname', '에러 메시지');

// 에러 초기화
$wire->resetErrorBag('form.fieldname');
```

## 7. UI 일관성 가이드

### 7.1 레이아웃 원칙
- 템플릿 수정 최소화: `jiny-admin::template.create` 유지
- 컴포넌트 레이아웃 유지: `jiny-admin::template.livewire.admin-create`
- 콘텐츠만 분리: `create.blade.php`에 순수 폼 요소만 작성

### 7.2 폼 구성 요소
- 폼 레이아웃: vertical 또는 horizontal
- 필수 필드 표시: 빨간색 별표(*)
- 도움말 텍스트: 필드 하단 회색 텍스트
- 에러 메시지: 필드 하단 빨간색 텍스트

### 7.3 버튼 배치
- 저장 버튼: 우측 정렬, 주 색상
- 계속 생성: enableContinueCreate 설정시 표시
- 목록 버튼: enableListButton 설정시 표시
- 취소 버튼: 좌측 정렬, 보조 색상

## 8. 특별한 기능 구현

### 8.1 계속 생성 기능
```php
if ($request->input('continue_creating')) {
    // 폼 초기화 후 같은 페이지 유지
    session()->flash('success', '생성되었습니다. 계속 추가할 수 있습니다.');
    return redirect()->back();
}
```

### 8.2 관련 데이터 처리
```php
public function hookStored($wire, $form)
{
    // 사용자 타입 카운트 증가
    if (isset($form['utype']) && $form['utype']) {
        DB::table('admin_user_types')
            ->where('code', $form['utype'])
            ->increment('user_count');
    }
}
```

## 9. 파일 생성 규칙

### 9.1 파일 명명 규칙
- 컨트롤러: `Admin{Feature}Create.php`
- 뷰 파일: `{feature}/create.blade.php`
- JSON 설정: 메인 `Admin{Feature}.json` 파일 공유

### 9.2 필수 검증 사항
1. JSON 설정의 `template.create` 확인
2. `create` 및 `store` 섹션 설정 검증
3. 필수 필드 검증 규칙 확인
4. Hook 메소드 구현 확인

## 10. 보안 고려사항

### 10.1 입력 검증
- 서버 사이드 검증 필수
- SQL Injection 방지
- XSS 방지를 위한 이스케이핑

### 10.2 패스워드 보안
- PasswordValidator 사용
- Hash::make()로 해싱
- 패스워드 정책 준수

### 10.3 중복 방지
- 유니크 필드 검증
- 트랜잭션 사용
- 동시성 제어

---

# 컨트롤러 리소스 - Edit 수정 페이지 생성 규칙

## 개요
@jiny/admin 패키지의 Edit 컨트롤러는 기존 데이터를 수정하는 폼 페이지를 제공합니다. Create와 유사하지만 기존 데이터를 로드하고 선택적 업데이트를 지원합니다.

## 1. 뷰 템플릿 전달 구조

### 1.1 기본 흐름
```
Controller → Data Load → JSON['template']['edit'] → View
```

- Admin**Edit 컨트롤러는 `AdminUsers.json` 파일의 `template.edit` 설정값으로 뷰를 전달합니다
- 기본값: `jiny-admin::template.edit` (특별한 경우를 제외하고 수정하지 않음)

### 1.2 컨트롤러 구현 예시
```php
public function __invoke(Request $request, $id)
{
    // 데이터 조회
    $data = DB::table($tableName)->where('id', $id)->first();
    
    if (!$data) {
        return redirect($redirectUrl)->with('error', '데이터를 찾을 수 없습니다.');
    }
    
    // 객체를 배열로 변환
    $form = (array) $data;
    
    // JSON 설정에서 뷰 경로 확인
    if (!isset($this->jsonData['template']['edit'])) {
        return response('Error: template.edit 설정이 필요합니다.', 500);
    }
    
    // 뷰 렌더링
    return view($this->jsonData['template']['edit'], [
        'controllerClass' => static::class,
        'jsonData' => $this->jsonData,
        'form' => $form,
        'id' => $id,
        'title' => 'Edit User',
        'subtitle' => '데이터를 수정합니다.'
    ]);
}
```

## 2. Edit 페이지 컴포넌트 구조

### 2.1 AdminEdit 컴포넌트
- **템플릿 레이아웃**: `jiny-admin::template.edit` (일관된 UX 유지)
- **컴포넌트 레이아웃**: `jiny-admin::template.livewire.admin-edit`
- **Include 파일**: `edit.blade.php` (순수한 폼 내용만 분리)
- **역할**: 기존 데이터 수정 폼 제공 및 처리

### 2.2 구조적 특징
```
template.edit (전체 레이아웃)
    └── admin-edit 컴포넌트
        └── jiny-admin::template.livewire.admin-edit (컴포넌트 레이아웃)
            └── edit.blade.php (순수 폼 콘텐츠 include)
```

## 3. Hook 시스템 - 데이터 처리

### 3.1 Hook 호출 체인
```
Data Load → Livewire Component → Hook Event → Controller Method → Update
```

### 3.2 주요 Hook 메소드

#### 기본 Hook 메소드
```php
// 수정 폼 초기화
public function hookEditing($wire, $form) {
    // 관련 데이터 조회 (예: 사용자 타입 목록)
    // Boolean 필드 변환
    // 패스워드 필드 제거 (보안)
    return $form;
}

// 데이터 업데이트 전 처리
public function hookUpdating($wire, $form) {
    // 기존 데이터 조회 (변경 감지용)
    // 선택적 패스워드 업데이트
    // 타임스탬프 갱신
    return $form; // 성공시 배열
    return "에러 메시지"; // 실패시 문자열
}

// 데이터 업데이트 후 처리
public function hookUpdated($wire, $form) {
    // 관련 데이터 업데이트 (예: 타입 변경시 카운트 조정)
    return $form;
}
```

#### 실시간 필드 검증 Hook (Edit 특화)
```php
// 이메일 필드 실시간 검증 (자기 자신 제외)
public function hookFormEmail($wire, $value, $fieldName = 'email') {
    $currentId = $wire->id ?? 0;
    
    // 중복 체크시 자기 자신 제외
    $exists = DB::table('users')
        ->where('email', $value)
        ->where('id', '!=', $currentId)
        ->exists();
}

// 패스워드 필드 검증 (선택적)
public function hookFormPassword($wire, $value, $fieldName = 'password') {
    // 비어있으면 검증 스킵 (수정시 선택사항)
    if (empty($value)) {
        $wire->resetErrorBag('form.password');
        return;
    }
    // 입력시만 검증
}
```

## 4. JSON 설정 구조

### 4.1 Edit 관련 설정
```json
{
    "template": {
        "edit": "jiny-admin::template.edit"
    },
    "edit": {
        "heading": {
            "title": "Edit User",
            "description": "Update user information"
        },
        "enableDelete": true,
        "enableListButton": true,
        "enableDetailButton": true,
        "enableSettingsDrawer": true,
        "editLayoutPath": "jiny-admin::template.livewire.admin-edit",
        "formPath": "jiny-admin::admin.admin_users.edit",
        "formLayout": "vertical"
    },
    "update": {
        "enableTransaction": true,
        "trackChanges": true,
        "redirects": {
            "success": "show",
            "error": "edit"
        },
        "messages": {
            "success": "User updated successfully.",
            "error": "Error updating user."
        },
        "validation": {
            "rules": {
                "name": "required|string|max:255",
                "email": "required|email",
                "password": "nullable|string|min:8|confirmed"
            }
        }
    }
}
```

## 5. Edit 특화 기능

### 5.1 선택적 필드 업데이트
```php
public function hookUpdating($wire, $form)
{
    // 패스워드는 입력된 경우에만 업데이트
    if (isset($form['password']) && !empty($form['password'])) {
        // 검증 및 해싱
        $form['password'] = Hash::make($form['password']);
    } else {
        // 비어있으면 업데이트하지 않음
        unset($form['password']);
    }
    
    // ID는 업데이트시 제거
    unset($form['id']);
    
    return $form;
}
```

### 5.2 변경 감지 및 처리
```php
public function hookUpdating($wire, $form)
{
    // 기존 데이터 조회
    $oldData = DB::table($tableName)->where('id', $wire->id)->first();
    
    // 변경 감지를 위해 이전 값 저장
    if ($wire && $oldData) {
        $wire->oldUtype = $oldData->utype;
    }
}

public function hookUpdated($wire, $form)
{
    // 타입이 변경된 경우 카운트 조정
    $oldUtype = $wire->oldUtype ?? null;
    $newUtype = $form['utype'] ?? null;
    
    if ($oldUtype !== $newUtype) {
        // 이전 타입 카운트 감소
        if ($oldUtype) {
            DB::table('admin_user_types')
                ->where('code', $oldUtype)
                ->decrement('user_count');
        }
        // 새 타입 카운트 증가
        if ($newUtype) {
            DB::table('admin_user_types')
                ->where('code', $newUtype)
                ->increment('user_count');
        }
    }
}
```

## 6. 데이터 로드 및 초기화

### 6.1 초기 데이터 처리
```php
public function hookEditing($wire, $form)
{
    // Boolean 필드 변환
    $form['isAdmin'] = (bool) ($form['isAdmin'] ?? false);
    
    // 민감한 정보 제거
    unset($form['password']); // 기존 패스워드 표시 안함
    
    // 관련 데이터 로드
    $userTypes = DB::table('admin_user_types')->get();
    if ($wire) {
        $wire->userTypes = $userTypes;
    }
    
    return $form;
}
```

## 7. UI 일관성 가이드

### 7.1 Edit 페이지 특징
- 기존 값 표시: 모든 필드에 현재 값 표시
- 패스워드 필드: 비워둠 (보안상 기존 값 미표시)
- 변경 표시: 수정된 필드 시각적 표시 (선택사항)

### 7.2 버튼 구성
- 저장 버튼: 변경사항 저장
- 삭제 버튼: enableDelete 설정시 표시
- 상세보기: enableDetailButton 설정시 표시
- 목록: enableListButton 설정시 표시

## 8. 검증 차이점

### 8.1 Create vs Edit 검증
| 항목 | Create | Edit |
|------|--------|------|
| 이메일 중복 | 전체 검사 | 자기 자신 제외 |
| 패스워드 | 필수 | 선택적 |
| 유니크 필드 | 엄격한 검증 | ID 제외 검증 |

### 8.2 선택적 검증 구현
```php
// Edit 전용 검증 규칙
'password' => 'nullable|string|min:8|confirmed'
// Create 검증 규칙
'password' => 'required|string|min:8|confirmed'
```

## 9. 파일 생성 규칙

### 9.1 파일 명명 규칙
- 컨트롤러: `Admin{Feature}Edit.php`
- 뷰 파일: `{feature}/edit.blade.php`
- JSON 설정: 메인 `Admin{Feature}.json` 파일 공유

### 9.2 필수 검증 사항
1. 데이터 존재 여부 확인
2. JSON 설정의 `template.edit` 확인
3. `edit` 및 `update` 섹션 설정 검증
4. 선택적 필드 처리 로직 확인

## 10. 보안 고려사항

### 10.1 권한 검증
- 수정 권한 확인
- 소유자 검증
- 데이터 접근 권한

### 10.2 데이터 보호
- 패스워드 미표시
- 민감 정보 마스킹
- 변경 이력 로깅

### 10.3 동시성 제어
- 낙관적 잠금
- 버전 관리
- 충돌 감지